!function(){"use strict";angular.module("fm",[])}(),function(){"use strict"}(),function(){"use strict";angular.module("fm").value("fmConfig",{templatesPrefix:"",actionsUrl:"",getTemplateUrl:function(e){return this.templatesPrefix+e+".html"},init:function(e,t){this.actionsUrl=t,this.templatesPrefix=e+"/templates/",this.extensionPrefix512=e+"/img/512px/",this.extensionPrefix32=e+"/img/32px/"},imgExtensions:["jpg","gif","png","jpeg","bmp","svg"],extensionPrefix512:"",extensionPrefix32:"",viewType:"list"})}(),function(){"use strict";function e(e,t,n,o){var r=angular.element(document.body),i=function(e){for(var t=0,n=0;e;)isNaN(e.offsetTop)||(t+=e.offsetTop),isNaN(e.offsetLeft)||(n+=e.offsetLeft),e=e.offsetParent;return{top:t,left:n}};return{restrict:"A",link:function(l,f,a){var c,s,u=l.$new(),p=function(){c&&c.remove(),u=null,c=null};f.on("click",function(){c=angular.element('<div style="display: none;" class="fm-dialog"></div>'),s=i(f[0]),u=l.$new(),angular.extend(u,{close:p}),a.fmDialogData&&(u.data=t(a.fmDialogData)(l)),n.get(o.getTemplateUrl(a.fmDialog),{cache:!0}).success(function(t){c.html(t),r.append(c),e(c)(u),c[0].style.cssText="left:"+s.left+"px;top:"+s.top+"px;"})}),l.$on("$destroy",function(){p()})}}}angular.module("fm").directive("fmDialog",["$compile","$parse","$http","fmConfig",e])}(),function(){"use strict";function e(e){return{scope:!0,link:function(t,n,o){n[0].ondragover=function(){return!1},n[0].ondragleave=function(){return!1},n[0].ondrop=function(n){return n.preventDefault(),t.$files=Array.prototype.slice.call(n.dataTransfer.files),t.$apply(function(){e(o.fmDropFiles)(t)}),!1},t.$on("fmEndUploading",function(){})}}}angular.module("fm").directive("fmDropFiles",["$parse","$compile",e])}(),function(){"use strict";function e(e){var t=e.imgExtensions,n=e.extensionPrefix512;return{scope:!0,templateUrl:e.getTemplateUrl("file"),link:function(e,o,r){var i=r.fmFile,l=(i.split(".").pop()||"").toLowerCase();-1==t.indexOf(l)?(e.file=n+l+".png",o.find("img").on("error",function(){this.src=n+"_blank.png"})):e.file=r.fmFilePrefix+"/"+i}}}angular.module("fm").directive("fmFile",["fmConfig",e])}(),function(){"use strict";function e(e,t,n){return{restrict:"E",replace:!0,scope:!0,templateUrl:t.getTemplateUrl("filemanager"),link:function(t,o,r){function i(){t.$broadcast("fmChange",{type:"reloadFiles",path:f})}function l(){t.$broadcast("fmChange",{type:"reloadFolders"})}var f="";t.selectedFiles=[],t.buffer={},t.$on("fmEvent",function(e,o){switch(e.stopPropagation(),o.type){case"copyFiles":return t.buffer.from=f,t.buffer.copy=!0,void(t.buffer.files=t.selectedFiles);case"moveFiles":return t.buffer.from=f,t.buffer.copy=!1,void(t.buffer.files=t.selectedFiles);case"pastFiles":return t.buffer.to=f,void n.past(t.buffer).then(i);case"removeFiles":return void n.removeFiles(f,t.selectedFiles).then(i);case"selectedFiles":return void(t.selectedFiles=o.selectedFiles);case"selectFolder":return f=o.path,i(),void t.$broadcast("fmChange",{type:"changeFolder",path:f});case"createFolder":var r=f+"/"+o.folderName;return void n.folderActions("createfolder",r).then(function(){t.$emit("fmEvent",{type:"selectFolder",path:r}),l()});case"removeFolder":return void n.folderActions("delfolder",f).then(function(){t.$emit("fmEvent",{type:"selectFolder",path:f.split("/").slice(0,-1).join("/")}),l()});case"uploadFiles":return t.$broadcast("fmChange",{type:"uploaded"}),void n.upload(o.files,f,function(e){t.$broadcast("fmChange",{type:"uploadProgress",progress:e.loaded/e.total*100})}).then(function(){i()});case"refresh":return i(),void l();case"changeView":return void t.$broadcast("fmChange",{type:"changeView",viewName:o.viewName})}}),t.insert=function(){var n;r.onSelect&&(n=t.$parent.$new(),n.$files={list:t.selectedFiles,path:f},e(r.onSelect)(n))}}}}angular.module("fm").directive("fileManager",["$parse","fmConfig","fmSrv",e])}(),function(){"use strict";function e(e,t){e.viewName="list",e.$on("fmChange",function(n,o){switch(o.type){case"reloadFiles":return void t.loadFiles(o.path+"/").then(function(t){e.path=o.path,e.files=t});case"changeView":return void(e.viewName=o.viewName)}}),e.$watch("files",function(t){e.$emit("fmEvent",{type:"selectedFiles",selectedFiles:(t||[]).filter(function(e){return e.selected})})},!0)}function t(e){return{restrict:"E",replace:!0,controller:"FilesListController",templateUrl:e.getTemplateUrl("fileslist")}}angular.module("fm").controller("FilesListController",["$scope","fmSrv",e]).directive("fmFilesList",["fmConfig",t])}(),function(){"use strict";function e(e,t){var n="";e.reload=function(){t.getFolders().then(function(t){n||e.select(t),e.node=t})},e.toggleExpand=function(e){e.expanded=!e.expanded},e.select=function(t){e.$emit("fmEvent",{type:"selectFolder",path:t.fullPath})},e.isActive=function(e){return e?e.fullPath==n:!1},e.reload(),e.$on("fmChange",function(t,o){switch(o.type){case"changeFolder":return void(n=o.path);case"reloadFolders":return void e.reload()}})}function t(e){return{restrict:"E",replace:!0,scope:!0,controller:"FoldersTreeController",templateUrl:e.getTemplateUrl("foldersTree"),link:function(){}}}angular.module("fm").controller("FoldersTreeController",["$scope","fmSrv",e]).directive("fmFoldersTree",["fmConfig",t])}(),function(){"use strict";function e(e){e.createFolder=function(t){e.$emit("fmEvent",{type:"createFolder",folderName:t}),e.close()}}angular.module("fm").controller("NewFolderController",["$scope",e])}(),function(){"use strict";function e(e){return{scope:!0,templateUrl:e.getTemplateUrl("progress"),link:function(e,t,n){e.$on(n.fmProgress,function(t,n){"number"==typeof n?(e.visible=!0,e.progress=n.toFixed(2)):e.visible=!1})}}}angular.module("fmProgress",["fmConfig",e])}(),function(){"use strict";function e(e){e.remove=function(){e.$emit("fmEvent",{type:e.data.remove}),e.close()}}angular.module("fm").controller("RemoveConfirmController",["$scope",e])}(),function(){"use strict";function e(e){e.type="list",e.$on("fmChange",function(t,n){"changeView"===n.type&&(e.type=n.viewName)}),e.setView=function(t){e.$emit("fmEvent",{type:"changeView",viewName:t})},e.refresh=function(){e.$emit("fmEvent",{type:"refresh"})}}function t(e){return{restrict:"E",replace:!0,templateUrl:e.getTemplateUrl("rightmenu"),controller:"RigthMenuController"}}angular.module("fm").controller("RigthMenuController",["$scope",e]).directive("fmRightMenu",["fmConfig",t])}(),function(){"use strict";function e(e,o,r,i){this.getFolders=function(){return e({url:i.actionsUrl,method:"GET"}).then(function(e){return n(e.data,e.data.prefix,0)})},this.loadFiles=function(t){return e({url:i.actionsUrl,params:{virtualpath:t},method:"GET"}).then(function(e){return e.data.files})},this.past=function(t){return e({url:i.actionsUrl,method:"POST",params:{c:t.copy?"copy":"move",virtualpath:t.to,addInfo:JSON.stringify({files:t.files.map(function(e){return e.name}),from:"/"==t.from[t.from.length-1]?t.from:t.from+"/"})}})},this.folderActions=function(t,n){return e({url:i.actionsUrl,method:"POST",params:{virtualpath:n,c:t}})},this.upload=function(e,t,n){var l=new FormData,f=new XMLHttpRequest;return l.append("virtualpath",t),l.append("c","upload"),e.forEach(function(e,t){l.append("files["+t+"]",e)}),f.open("POST",i.actionsUrl),r(function(e,t){f.onload=function(){e(f.responseText)},f.upload.onprogress=function(){o.$$phase||o.$apply(function(){(n||angular.noop).apply(this,arguments)})},f.onerror=t,f.send(l)})},this.removeFiles=function(n,o){return e({url:i.actionsUrl,method:"POST",params:{c:"del",virtualpath:n,addInfo:JSON.stringify(t(o))}})}}function t(e){return e.map(function(e){return e.name})}function n(e,t,o){return e.fullPath=t+e.name,e.level=o,e.expanded=!0,e.folders.forEach(function(t){n(t,e.fullPath+"/",o+1)}),e}angular.module("fm").service("fmSrv",["$http","$rootScope","$q","fmConfig",e])}(),function(){"use strict";function e(e){e.isCopied=!1,e.$on("fmChange",function(t,n){"reloadFiles"==n.type&&(e.isFolderSelected=!0)}),e.copyFiles=function(){e.$emit("fmEvent",{type:"copyFiles"}),e.isCopied=!0},e.moveFiles=function(){e.$emit("fmEvent",{type:"moveFiles"}),e.isCopied=!0},e.pastFiles=function(){e.$emit("fmEvent",{type:"pastFiles"}),e.isCopied=!1}}function t(e){return{restrict:"E",replace:!0,templateUrl:e.getTemplateUrl("topmenu"),controller:"TopMenuController"}}angular.module("fm").controller("TopMenuController",["$scope","fmSrv",e]).directive("fmTopMenu",["fmConfig",t])}(),function(){"use strict";function e(e){e.files=[],e.addToList=function(t){e.files=e.files.concat(t)},e.upload=function(t){e.$emit("fmEvent",{type:"uploadFiles",files:t})},e.$on("fmChange",function(t,n){"uploaded"===n.type&&(e.uploading=!1,e.close())}),e.remove=function(t){e.files.splice(t,1)}}angular.module("fm").controller("UploadController",["$scope","fmSrv",e])}(),function(){"use strict";function e(e){var t=angular.element('<input style="display: none" multiple="multiple" type="file"/>'),n=angular.element(document.body);return{scope:!0,link:function(o,r,i){n.append(t),t.on("change",function(){o.$files=Array.prototype.slice.call(this.files),o.$apply(function(){e(i.fmUploadFile)(o)})}),r.on("click",function(){t[0].click?t[0].click():t[0].onclick&&t[0].onclick()})}}}angular.module("fm").directive("fmUploadFile",["$parse",e])}();